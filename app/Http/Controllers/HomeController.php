<?php

namespace App\Http\Controllers;

use App\Models\Category;
use App\Models\Post;
use App\Models\SubCategory;
use App\Models\User;
use Carbon\Carbon;
use CyrildeWit\EloquentViewable\Support\Period;
use Illuminate\Http\Request;
use Illuminate\Support\Collection;
use Illuminate\Support\Facades\DB;
use Illuminate\Support\Facades\Log;
use Illuminate\Support\Str;
use Kreait\Firebase\Factory;

class HomeController extends Controller
{
    public function index(Request $request)
    {
        $quotes = Collection::make([
            'An unexamined life is not worth living. - Socrates',
            'Be present above all else. - Naval Ravikant',
            'He who is contented is rich. - Laozi',
            'No surplus words or unnecessary actions. - Marcus Aurelius',
            'Order your soul. Reduce your wants. - Augustine',
            'Simplicity is an acquired taste. - Katharine Gerould',
            'Simplicity is the essence of happiness. - Cedric Bledsoe',
            'Simplicity is the ultimate sophistication. - Leonardo da Vinci',
            'Smile, breathe, and go slowly. - Thich Nhat Hanh',
            'Well begun is half done. - Aristotle',
        ]);
        $popPosts = Post::orderByViews('desc', Period::pastDays(3))->limit(7)->get();
        $lastestPosts = Post::with('subCategory.category', 'user')->orderBy('id', 'desc')->limit(12)->get();
        $categories = Category::with('subCategories.posts')->get();

        return view('home', [
            'quotes' => $quotes,
            'popPosts' => $popPosts,
            'lastestPosts' => $lastestPosts,
            // 'topWriters' => $topWriters,
            'categories' => $categories,
        ]);
    }

    public function test()
    {
        // $factory = (new Factory())->withDatabaseUri('https://uet-news-2021-default-rtdb.firebaseio.com/');
        $factory = (new Factory())->withDatabaseUri('https://pylbox-code-tieumomo-default-rtdb.firebaseio.com/');

        $database = $factory->createDatabase();
        for($i = 0; $i <= 3; $i++) {
            // $database->getReference('items/' . $i)->remove();

            $database->getReference('items/' . Carbon::now()->timestamp)->set([
                'box' => 'Codes',
                'detail' => '<pre><span style=\"font-family: &quot;Courier New&quot;;\"># For more information on configuration, see:<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp;* Official English Documentation: http://nginx.org/en/docs/<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp;* Official Russian Documentation: http://nginx.org/ru/docs/</span><br><span style=\"font-family: &quot;Courier New&quot;;\">user nginx;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">worker_processes auto;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">error_log /var/log/nginx/error.log;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">pid /run/nginx.pid;</span><br><span style=\"font-family: &quot;Courier New&quot;;\"># Load dynamic modules. See /usr/share/doc/nginx/README.dynamic.<br></span><span style=\"font-family: &quot;Courier New&quot;;\">include /usr/share/nginx/modules/*.conf;</span><br><span style=\"font-family: &quot;Courier New&quot;;\">events {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; worker_connections 1024;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">}</span><br><span style=\"font-family: &quot;Courier New&quot;;\">http {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; log_format&nbsp; main&nbsp; \'$remote_addr - $remote_user [$time_local] \"$request\" \'<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \'$status $body_bytes_sent \"$http_referer\" \'<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; \'\"$http_user_agent\" \"$http_x_forwarded_for\"\';</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; access_log&nbsp; /var/log/nginx/access.log&nbsp; main;</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; sendfile&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; on;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; tcp_nopush&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; on;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; tcp_nodelay&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;on;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; keepalive_timeout&nbsp; &nbsp;65;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; types_hash_max_size 2048;</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; include&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/etc/nginx/mime.types;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; default_type&nbsp; &nbsp; &nbsp; &nbsp; application/octet-stream;</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; # Load modular configuration files from the /etc/nginx/conf.d directory.<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; # See http://nginx.org/en/docs/ngx_core_module.html#include<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; # for more information.<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; include /etc/nginx/conf.d/*.conf;</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; server {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; listen&nbsp; &nbsp; &nbsp; &nbsp;80 default_server;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; listen&nbsp; &nbsp; &nbsp; &nbsp;[::]:80 default_server;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; server_name&nbsp; localhost;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/usr/share/nginx/html/news-git/public;<br></span><span style=\"white-space: pre; font-family: &quot;Courier New&quot;;\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">index&nbsp; &nbsp; &nbsp; &nbsp; index.php index.html index.htm;</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; # Load configuration files for the default server block.<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; include /etc/nginx/default.d/*.conf;</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; location / {<br></span><span style=\"white-space: pre; font-family: &quot;Courier New&quot;;\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; #root /usr/share/nginx/html;<br></span><span style=\"white-space: pre; font-family: &quot;Courier New&quot;;\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; try_files $uri $uri/ /index.php$is_args$args;<br></span><span style=\"white-space: pre; font-family: &quot;Courier New&quot;;\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; autoindex on;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; autoindex_exact_size off;</span><span style=\"white-space:pre\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp;&nbsp;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span style=\"white-space: pre; font-family: &quot;Courier New&quot;;\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">location ~ \\.php$ {<br></span><span style=\"white-space: pre; font-family: &quot;Courier New&quot;;\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; try_files $uri =404;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_split_path_info ^(.+\\.php)(/.+)$;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # NOTE: You should have \"cgi.fix_pathinfo = 0;\" in php.ini</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # With php5-cgi alone:<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #fastcgi_pass 127.0.0.1:9000;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; # With php5-fpm:<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; fastcgi_pass 127.0.0.1:9000;<br></span><span style=\"white-space: pre; font-family: &quot;Courier New&quot;;\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; fastcgi_param&nbsp; SCRIPT_FILENAME $document_root$fastcgi_script_name;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; #fastcgi_param&nbsp; SCRIPT_FILENAME $document_root;<br></span><span style=\"white-space: pre; font-family: &quot;Courier New&quot;;\">\t</span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; fastcgi_index index.php;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; include fastcgi_params;&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; error_page 404 /404.html;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; location = /404.html {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; }</span><br><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; error_page 500 502 503 504 /50x.html;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; location = /50x.html {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span style=\"font-family: &quot;Courier New&quot;;\">&nbsp; &nbsp; }</span><br><span style=\"font-family: &quot;Courier New&quot;;\"># Settings for a TLS enabled server.<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; server {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; listen&nbsp; &nbsp; &nbsp; &nbsp;443 ssl http2 default_server;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; listen&nbsp; &nbsp; &nbsp; &nbsp;[::]:443 ssl http2 default_server;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; server_name&nbsp; _;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; root&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;/usr/share/nginx/html;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; ssl_certificate \"/etc/pki/nginx/server.crt\";<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; ssl_certificate_key \"/etc/pki/nginx/private/server.key\";<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; ssl_session_cache shared:SSL:1m;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; ssl_session_timeout&nbsp; 10m;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; ssl_ciphers HIGH:!aNULL:!MD5;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; ssl_prefer_server_ciphers on;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; # Load configuration files for the default server block.<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; include /etc/nginx/default.d/*.conf;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; location / {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; error_page 404 /404.html;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; location = /404.html {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; error_page 500 502 503 504 /50x.html;<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; location = /50x.html {<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; &nbsp; &nbsp; }<br></span><span style=\"font-family: &quot;Courier New&quot;;\">#&nbsp; &nbsp; }</span><br><span style=\"font-family: &quot;Courier New&quot;;\">}</span></pre><p><br></p>',
                'image' => 'img/errors/404.png',
                'source' => 'Me',
                'sourceLink' => 'https://www.facebook.com/pyl.walker',
                'sumary' => 'Old Nginx config for Laravel Old Nginx config for Laravel Old Nginx config for Laravel Old Nginx config for Laravel Old Nginx config for Laravel Old Nginx config for Laravel',
                'title' => Str::random(20)
            ]);
        }

        return "Done";
    }
}
